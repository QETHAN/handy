define("#pageTransition/0.9.1/pageTransition",["#events/0.9.1/events","#zepto/1.0.0/zepto"],function(e,t,n){function o(e){this.options=i.extend({},s,e),this._prevPages=[],this._step=0,this._DATAATTRIBUTENAMESPACE="data-pageTransition"}var r=e("#events/0.9.1/events"),i=e("#zepto/1.0.0/zepto"),s={element:null};r.mixTo(o),o.prototype.transition=function(e){this.nextPage=i(e);if(this.getPage()&&this.getPage()[0]===this.nextPage.get(0))return;this._nextPageParent=this.nextPage.parent(),this._transitionForward()},o.prototype.back=function(){this._transitionBack()},o.prototype.getPage=function(){return this.page},o.prototype.render=function(){this._insertPageViewport(),this.sync(),this.bindUI()},o.prototype.sync=function(){var e=i(this.options.element),t=e.css("width"),n=this.viewport.find("*["+this._DATAATTRIBUTENAMESPACE+"-role=page]");this.viewport.css({width:parseInt(t,10)*n.length}),e.css({overflow:"hidden"}),n.css({"float":"left",width:t}).show()},o.prototype.bindUI=function(){var e=this._DATAATTRIBUTENAMESPACE,t=this.viewport.find("*["+e+"-role=trigger]");t.unbind("click.pageTransition").bind("click.pageTransition",i.proxy(function(t){t.preventDefault();var n=i(t.currentTarget).attr(""+e+"-action");switch(n){case"forward":this.nextPage=i(i(t.currentTarget).attr(""+e+"-forward")),this._nextPageParent=this.nextPage.parent(),this._transitionForward();break;case"back":this._transitionBack()}},this))},o.prototype.destroy=function(){var e=this._DATAATTRIBUTENAMESPACE,t=this.viewport.find("*["+e+"-role=trigger]");t.unbind("click.pageTransition"),i(this.options.element).attr("style",null).append(this._originPage.attr("style",null)),this.page.removeAttr("style").appendTo(this._nextPageParent).hide(),this.viewport.remove(),this._step=0,this._prevPages=[],this.page=null,this.nextPage=null,this.viewport=null,this._nextPageParent=null,this._originPage=null},o.prototype._transitionForward=function(){this.trigger("transitionStart","forward",this.page,this),this.nextPage.appendTo(this.viewport),this.sync(),this.viewport.animate({marginLeft:-parseInt(i(this.options.element).css("width"),10)},300,null,i.proxy(function(){this.__transitionForwardEnd()},this))},o.prototype.__transitionForwardEnd=function(){this.page.appendTo(this._nextPageParent).hide(),this.bindUI(),this.trigger("transitionEnd","forward",this.nextPage,this),this._prevPages.push(this.page),this._step++,this.page=this.nextPage,this.viewport.css({marginLeft:0}),this.sync()},o.prototype._transitionBack=function(){if(this._step<=0)return;this.trigger("transitionStart","back",this.page,this),this.viewport.prepend(this._prevPages[this._step-1]),this.sync(),this.viewport.css({marginLeft:-parseInt(i(this.options.element).css("width"),10)}),this.viewport.animate({marginLeft:0},300,null,i.proxy(function(){this._transitionBackEnd()},this))},o.prototype._transitionBackEnd=function(){this.page.appendTo(this._nextPageParent).hide(),this.bindUI();var e=this._prevPages[this._step-1]||this._originPage;this.trigger("transitionEnd","back",e,this),this.nextPage=this.page,this.page=this._prevPages[this._step-1],this.viewport.css({marginLeft:0}),this._prevPages.splice(this._step-1),this._step--,this.sync()},o.prototype._insertPageViewport=function(){var e=this._DATAATTRIBUTENAMESPACE,t=i(this.options.element),n=i("<div "+e+'-role="viewport"></div>'),r=i(t.find("*["+e+"-role=page]")[0]);r.wrapAll(n),this.viewport=i(n,t),this.page=r,this._originPage=r},n.exports=o});